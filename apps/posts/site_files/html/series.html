<!DOCTYPE html>
<html lang="en" data-ng-app="myApp">
  <head x-import="head.html">
    <link rel="stylesheet" href="/css/posts.css?##site.options.version##" />
  </head>

  <body class="##session.lang##" ng-controller="posts">
    <nav class="sitebar" x-import="sitebar/index.html" ng-controller="sitebar"></nav>

    <div x-import="posts/new_post_modal.html"></div>
    <div x-import="posts/new_url_modal.html"></div>
    <div x-import="posts/new_author_modal.html"></div>
    <div x-import="posts/new_post_category_modal.html"></div>

    <div id="main-layout" class="container loaded">
      <div x-import="posts/post_categories.html"></div>

      <div class="row">
        <div class="col2">
          <div x-import="posts/post_types.html"></div>
          <div x-feature="os.desktop">
            <!-- desktop_right_ad -->
            <ins class="adsbygoogle" style="display: block;" data-ad-client="ca-pub-3372007384613151" data-ad-slot="4885184263" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
        </div>
        <div class="col7">
          <div>
            <div id="posts" class="posts">
              <div class="post series" id="post_##data.id##">
                <div class="header">
                  <img src="##data.author.logo_url##" alt="" onerror="this.onerror=null;this.src='/images/no.png'" />
                  <h2>
                    <a>##data.author.name##</a>
                  </h2>
                  <span date="##data.date##"> ##data.timeago## </span>
                </div>
                <div class="body">
                  <div class="row">
                    <div class="col3">
                      <div class="details">
                        <a rel="nofollow" href="##data.details.url##" target="_blank">
                          <img class="image" src="##data.details.image_url##" alt="##data.details.title##" onerror="this.onerror=null;this.src='/images/no.png'" />
                        </a>
                      </div>
                    </div>
                    <div class="col9">
                      <h2 class="text">##data.page_title2##</h2>
                      <p class="description">##data.details.description##</p>
                      <p class="blue">
                        ##word.posts_episode_count##
                        <span class="bold"> ##data.episode_count## </span>
                      </p>
                      <a x-permission="send-online" onclick="akwam.send_online()" class="btn"> Send To Server </a>
                      <a x-permission="remove-series" onclick="akwam.remove()" class="btn remove"> Remove Series </a>
                      <a x-permission="re-upload-series" onclick="akwam.re_upload_serie()" class="btn"> Re-Upload Series </a>
                    </div>
                  </div>
                  <div id="episode_list"></div>
                </div>

                <div class="footer">
                  <ul class="share-buttons">
                    <li>
                      <a rel="nofollow" href="https://www.facebook.com/sharer/sharer.php?u=##data.post_url##&t=" title="انشر الصفحة على الفيسبوك" target="_blank"><img alt="share" src="/images/social/Facebook.png" /></a>
                    </li>
                    <li>
                      <a rel="nofollow" href="https://twitter.com/intent/tweet?source=##data.post_url##&text=:%20##data.post_url##" target="_blank" title="انشر الصفحة على تويتر"><img alt="share" src="/images/social/Twitter.png" /></a>
                    </li>
                    <li>
                      <a rel="nofollow" href="https://plus.google.com/share?url=##data.post_url##" target="_blank" title="انشر الصفحة على جوجل"><img alt="share" src="/images/social/Google.png" /></a>
                    </li>
                    <li class="hidden">
                      <a rel="nofollow" href="http://www.tumblr.com/share?v=3&u=##data.post_url##&t=&s=" target="_blank" title="انشر الصفحة على Tumblr"><img alt="share" src="/images/social/Tumblr.png" /></a>
                    </li>
                    <li>
                      <a rel="nofollow" href="http://pinterest.com/pin/create/button/?url=##data.post_url##&description=" target="_blank" title="انشر الصفحة على Pin it"><img alt="share" src="/images/social/Pinterest.png" /></a>
                    </li>
                    <li class="hidden">
                      <a rel="nofollow" href="https://getpocket.com/save?url=##data.post_url##&title=" target="_blank" title="اضف الصفحة الى  Pocket"><img alt="share" src="/images/social/Pocket.png" /></a>
                    </li>
                    <li>
                      <a rel="nofollow" href="http://www.reddit.com/submit?url=##data.post_url##&title=" target="_blank" title="اضف الصفحة الى  Reddit"><img alt="share" src="/images/social/Reddit.png" /></a>
                    </li>
                    <li>
                      <a rel="nofollow" href="http://www.linkedin.com/shareArticle?mini=true&url=##data.post_url##&title=&summary=&source=##data.post_url##" target="_blank" title="اشر الصفحة على LinkedIn"><img alt="share" src="/images/social/LinkedIn.png" /></a>
                    </li>
                    <li class="hidden">
                      <a rel="nofollow" href="http://wordpress.com/press-this.php?u=##data.post_url##&t=&s=" target="_blank" title="انشر الصفحة على WordPress"><img alt="share" src="/images/social/Wordpress.png" /></a>
                    </li>
                    <li class="hidden">
                      <a rel="nofollow" href="https://pinboard.in/popup_login/?url=##data.post_url##&title=&description=" target="_blank" title="احفظ الصفحة على Pinboard"><img alt="share" src="/images/social/Pinboard.png" /></a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div>
              <!-- Post Ad-->
              <ins class="adsbygoogle" style="display: block; text-align: center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3372007384613151" data-ad-slot="5838870332"></ins>
              <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
              </script>
            </div>
          </div>
        </div>
        <div class="col3">
          <div x-import="posts/site_news.html"></div>
          <div x-feature="os.desktop">
            <!-- desktop_left_ad -->
            <ins class="adsbygoogle" style="display: block;" data-ad-client="ca-pub-3372007384613151" data-ad-slot="3212816421" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
        </div>
      </div>
    </div>

    <div x-import="scripts.html"></div>
    <script>
      window.stop_loading_posts = true;
    </script>
    <script id="episode-template" type="x-tmpl-mustache" x-import="posts/episode-template.html"></script>
    <script x-feature="browser.social.app" x-import="posts/browser.js"></script>

    <script x-import="posts/index.js"></script>
    <script x-import="posts/posts.js"></script>
    <script x-import="posts/akwam.js"></script>
    <script>
      var post = {
        id: "##data.id##",
        url: "##data.ref_url##",
        text: "##data.text##",
        episode_list: JSON.parse(`##data.episode_list##`),
      };
      for (let index = post.episode_list.length - 1; index > -1; index--) {
        post.episode_list[index].id = index;
        let rendered = site.render("#episode-template", post.episode_list[index]);
        $("#episode_list").append(rendered);
      }

      function show_episode_watch_list(ep) {
        $("#show_" + ep.index).hide("slow");
        $("#show_list_" + ep.index).html("");
        setTimeout(() => {
          post.episode_list[ep.index].show_watch_list.forEach((l , i) => {
            let out = site.html(`<a class="btn show-link" target="_blank" href="{{url}}"> ##word.posts_show_server## ${i+1}  </a>`, l);
            $("#show_list_" + ep.index).append(out);
          });
        }, 1000);
      }

      function show_episode_download_list(ep) {
        $("#download_" + ep.index).hide("slow");
        $("#download_list_" + ep.index).html("");
        setTimeout(() => {
          post.episode_list[ep.index].download_list.forEach((l) => {
            let out = site.html(`<a class="btn download-link" target="_blank" href="{{href}}"> ##word.posts_download## ( {{size}} )  </a>`, l);
            $("#download_list_" + ep.index).append(out);
          });
        }, 1000);
      }

      function show_episode(ep) {
        $("#show_" + ep.index).hide();
        $(".posts-loading").remove();
        $("#watch_list_" + ep.index).append('<p class="posts-loading"> <img src="/images/loading.gif">  </p>');

        ep.watch_list = [];
        spider.get_page_content(
          {
            url: ep.url,
          },
          function (data) {
            data.tags.forEach(function (tag) {
              if (tag.tagName == "A" && tag.href && tag.value && tag.href.like("*watch*")) {
                spider.get_page_content(
                  {
                    url: tag.href,
                  },
                  function (data) {
                    data.tags.forEach(function (tag) {
                      if (tag.className == "download-link") {
                        spider.get_page_content(
                          {
                            url: tag.href,
                          },
                          function (data) {
                            data.tags.forEach(function (tag) {
                              if (tag.tagName == "SOURCE") {
                                let exists = false;
                                ep.watch_list.forEach((s) => {
                                  if (s.src == tag.src) {
                                    exists = true;
                                  }
                                });
                                if (!exists) {
                                  ep.watch_list.push({
                                    type: tag.type,
                                    size: tag.size,
                                    href: tag.src,
                                    guid: tag.src + tag.size,
                                  });
                                }
                              }
                            });
                          }
                        );
                      }
                    });
                  }
                );
              }
            });
          }
        );
        setTimeout(() => {
          site.getUniqueObjects(ep.watch_list, "guid").forEach((l) => {
            l.title = " مسلسل " + post.text + " - " + post.episode_list[ep.index].title;
            let out = site.html(`<a class="btn show-link" target="_blank" href="/show-video?url={{href}}&title={{title}}"> ##word.posts_show## ( {{size}} )  </a>`, l);
            $("#watch_list_" + ep.index).append(out);
          });
          $(".posts-loading").remove();
        }, 1000 * 5);
      }

      function download_episode(ep) {
        $("#download_" + ep.index).hide();
        $(".posts-loading").remove();
        $("#download_list_" + ep.index).append('<p class="posts-loading"> <img src="/images/loading.gif">  </p>');

        ep.download_list = [];
        spider.get_page_content(
          {
            url: ep.url,
          },
          (data) => {
            data.tags.forEach((tag) => {
              if (tag.tagName == "A" && tag.href && tag.value && tag.href.like("*link*")) {
                spider.get_page_content(
                  {
                    url: tag.href,
                  },
                  (data) => {
                    data.tags.forEach((tag2) => {
                      if (tag2.className == "download-link") {
                        spider.get_page_content(
                          {
                            url: tag2.href,
                          },
                          (data) => {
                            data.tags.forEach((tag3) => {
                              if (tag3.tagName == "A" && tag3.className.like("link*")) {
                                let exists = false;
                                ep.download_list.forEach((s) => {
                                  if (s.href == tag3.href) {
                                    exists = true;
                                  }
                                });
                                if (!exists) {
                                  let t = {};
                                  t.href = tag3.href;
                                  t.size = "HD";
                                  if (t.href.like("*480*")) {
                                    t.size = "480";
                                  } else if (t.href.like("*720*")) {
                                    t.size = "720";
                                  } else if (t.href.like("*1080*")) {
                                    t.size = "1080";
                                  } else if (t.href.like("*360*")) {
                                    t.size = "360";
                                  }
                                  ep.download_list.push(t);
                                }
                              }
                            });
                          }
                        );
                      }
                    });
                  }
                );
              }
            });
          }
        );
        setTimeout(() => {
          site.getUniqueObjects(ep.download_list, "href").forEach((l) => {
            let out = site.html(`<a class="btn download-link" target="_blank" href="{{href}}"> ##word.posts_download## ( {{size}} )  </a>`, l);
            $("#download_list_" + ep.index).append(out);
          });
          $(".posts-loading").remove();
        }, 1000 * 5);
      }
    </script>
  </body>
</html>
